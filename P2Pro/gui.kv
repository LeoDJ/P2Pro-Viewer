#:kivy 1.0
#:import Clock kivy.clock

#:set slider_cursor_size (20, 20)
#:set sidebar_row_height 30
#:set sidebar_pad 5

# Debug Widget view
# <Widget>:
#     canvas.after:
#         Line:
#             rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#             dash_offset: 5
#             dash_length: 2

# <StackLayout>:
#     canvas.after:
#         Color:
#             rgb: 1,0,0
#         Line:
#             rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#         Color:
#             rgb: 1,1,1


MDBoxLayout:
    orientation: 'horizontal'

    # Image widget
    Image:
        id: image_widget

    # Scale layout
    BoxLayout:
        orientation: 'vertical'
        width: 60
        size_hint_x: None

        canvas.before:
            Color:
                rgba: 0.5, 0.5, 0.5, 1
            Rectangle:
                # self here refers to the widget i.e FloatLayout
                pos: self.pos
                size: self.size

        ToggleButton:
            id: btn_auto_max
            text: 'Auto'
            height: self.texture_size[1] + 4
            size_hint_y: None
            state: 'down'
        TextInput:
            id: input_temp_max
            text: '000.0 ¬∞C'
            size_hint_y: None
            height: self.minimum_height
            padding: 2
            halign: 'center'
            multiline: False
        FloatLayout:
            canvas:
                Color:
                    rgba: 0, 0, 0.5, 1
                Rectangle:
                    pos: self.x + self.width / 2, self.y
                    size: self.width / 2, self.height
            # Scale:
            #     pos_hint: '{right: 1}'
            #     size_hint: 1, 1
            #     id: scale
        TextInput:
            id: input_temp_min
            text: '000.0 ¬∞C'
            size_hint_y: None
            height: self.minimum_height
            padding: 2
            halign: 'center'
            multiline: False
        ToggleButton:
            id: btn_auto_min
            text: 'Auto'
            height: self.texture_size[1] + 4
            size_hint_y: None
            state: 'down'


    # Sidebar layout
    # BoxLayout:
        # orientation: 'vertical'
    MDGridLayout:
        cols: 1
        size_hint_x: None
        width: 280
        spacing: sidebar_pad
        padding: sidebar_pad
        # row_force_default: True
        # row_default_height: sidebar_row_height

        MDLabel:
            text: 'P2 Pro Viewer'
            size_hint_y: None
            size: self.texture_size
            font_size: 32
            halign: 'center'
            canvas.before:
                Color:
                    rgba: 0, 0.4, 0, 1
                Rectangle:
                    # self here refers to the widget i.e FloatLayout
                    pos: self.x - sidebar_pad, self.y 
                    # size: self.parent.size
                    size: self.width + 2 * sidebar_pad, self.height + sidebar_pad

        # Sliders
        MDSlider:
            id: brightness_slider
            min: -1
            max: 1
            value: 0
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            # cursor_size: slider_cursor_size
            # background_width: 15
        MDLabel:
            text: 'Brightness'
            size_hint_y: None
            height: 20
            halign: 'center'
        MDSlider:
            id: contrast_slider
            min: 0
            max: 2
            value: 1
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            # cursor_size: slider_cursor_size
            # background_width: 15
        MDLabel:
            text: 'Contrast'
            size_hint_y: None
            height: 20
            halign: 'center'

        # Temperature range selection
        MDGridLayout:
            cols: 3
            # height: sidebar_row_height
            # size_hint_y: None
            adaptive_height: True
            MDLabel:
                text: 'Temperature Range:'
                # adaptive_width: True
            MDSwitch:
                id: switch_high_temp
                height: sidebar_row_height
            # MDSegmentedControl:
            #     size_hint_x: 0.8
            #     # adaptive_width: True
            #     MDSegmentedControlItem:
            #         adaptive_width: True
            #         text: 'Normal'
            #         active: True
            #     MDSegmentedControlItem:
            #         adaptive_width: True
            #         # size_hint_x: 0.04
            #         text: 'High'

        # Palette selection
        MDGridLayout:
            cols: 2
            height: sidebar_row_height
            size_hint_y: None
            MDLabel:
                text: 'Palette:  '
                # size: self.texture_size
                # size_hint_x: None
            MDDropDownItem:
                # size_hint: None, None
                # size: 100, 44
                # pos_hint: {'center': (.5, .5)}
                id: select_palette
                text: 'Home'
                # values: 'Home', 'Work', 'Other', 'Custom'
                # on_text:
                #     print("The spinner {} has text {}".format(self, self.text))
                on_release: app.menu.open() # TODO

        MDLabel:
            id: filler

        # Transport buttons
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: sidebar_row_height
            spacing: 5
            # ToggleButton:
            #     id: btn_rec
            #     text: 'üî¥'
            #     font_name: 'seguiemj'
            #     # on_press: self.text = '‚¨õÔ∏è'
            #     on_state: 
            #         self.text = '‚¨õÔ∏è' if self.state == 'down' else 'üî¥'
            #         print("Start" if self.state == 'down' else "Stop", "recording") #
            # Button:
            #     id: btn_photo
            #     text: 'üì∏'
            #     font_name: 'seguiemj'
            #     on_press: print("Cheeeese!")
            MDFillRoundFlatIconButton:
                text: 'Record'
                icon: 'record'
                size_hint_x: 0.5
                on_press: 
                    self.text = 'Stop'
                    self.icon = 'stop'
                    self.md_bg_color = 'red'
            MDFillRoundFlatIconButton:
                id: btn_photo
                text: 'Photo'
                icon: 'camera'
                size_hint_x: 0.5
        
        # Timer and attribution
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            Label:
                text: '00:00:00'
                width: self.parent.width / 2
                height: self.texture_size[1]
                size_hint_x: None
            Label:  # Filler
            Label:
                text: 'by LeoDJ'
                size: self.texture_size
                size_hint: None, None
                # text_size: self.size
                # halign: 'right'

# Schedule frame update
# on_start: root.update_frame()