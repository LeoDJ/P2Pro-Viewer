#:kivy 1.0
#:import Clock kivy.clock

#:set slider_cursor_size (20, 20)
#:set sidebar_row_height 30
#:set sidebar_pad 5

# Debug Widget view
# <Widget>:
#     canvas.after:
#         Line:
#             rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#             dash_offset: 5
#             dash_length: 2

# <StackLayout>:
#     canvas.after:
#         Color:
#             rgb: 1,0,0
#         Line:
#             rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#         Color:
#             rgb: 1,1,1


BoxLayout:
    orientation: 'horizontal'

    # Image widget
    Image:
        id: image_widget

    # Scale layout
    BoxLayout:
        orientation: 'vertical'
        width: 60
        size_hint_x: None

        canvas.before:
            Color:
                rgba: 0.5, 0.5, 0.5, 1
            Rectangle:
                # self here refers to the widget i.e FloatLayout
                pos: self.pos
                size: self.size

        ToggleButton:
            id: btn_auto_max
            text: 'Auto'
            height: self.texture_size[1] + 4
            size_hint_y: None
            state: 'down'
        TextInput:
            id: input_temp_max
            text: '000.0 ¬∞C'
            size_hint_y: None
            height: self.minimum_height
            padding: 2
            halign: 'center'
            multiline: False
        FloatLayout:
            canvas:
                Color:
                    rgba: 0, 0, 0.5, 1
                Rectangle:
                    pos: self.x + self.width / 2, self.y
                    size: self.width / 2, self.height
            # Scale:
            #     pos_hint: '{right: 1}'
            #     size_hint: 1, 1
            #     id: scale
        TextInput:
            id: input_temp_min
            text: '000.0 ¬∞C'
            size_hint_y: None
            height: self.minimum_height
            padding: 2
            halign: 'center'
            multiline: False
        ToggleButton:
            id: btn_auto_min
            text: 'Auto'
            height: self.texture_size[1] + 4
            size_hint_y: None
            state: 'down'


    # Sidebar layout
    # BoxLayout:
        # orientation: 'vertical'
    GridLayout:
        cols: 1
        size_hint_x: None
        width: 280
        spacing: sidebar_pad
        padding: sidebar_pad
        # row_force_default: True
        # row_default_height: sidebar_row_height

        Label:
            text: 'P2 Pro Viewer'
            size_hint_y: None
            size: self.texture_size
            font_size: 32
            canvas.before:
                Color:
                    rgba: 0, 0.4, 0, 1
                Rectangle:
                    # self here refers to the widget i.e FloatLayout
                    pos: self.x - sidebar_pad, self.y 
                    # size: self.parent.size
                    size: self.width + 2 * sidebar_pad, self.height + sidebar_pad

        # Sliders
        Slider:
            id: brightness_slider
            min: -1
            max: 1
            value: 0
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            cursor_size: slider_cursor_size
            background_width: 15
        Label:
            text: 'Brightness'
            size_hint_y: None
            height: 20
        Slider:
            id: contrast_slider
            min: 0
            max: 2
            value: 1
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            cursor_size: slider_cursor_size
            background_width: 15
        Label:
            text: 'Contrast'
            size_hint_y: None
            height: 20

        # Temperature range selection
        GridLayout:
            cols: 3
            height: sidebar_row_height
            size_hint_y: None
            Label:
                text: 'High Temperature Range:'
                size: self.texture_size
                size_hint_x: None
            # ToggleButton:
            #     text: 'Normal'
            #     group: 'temp_mode'
            #     state: 'down'
            # ToggleButton:
            #     text: 'High'
            #     group: 'temp_mode'
            Switch:
                id: switch_high_temp

        # Palette selection
        GridLayout:
            cols: 2
            height: sidebar_row_height
            size_hint_y: None
            Label:
                text: 'Palette:  '
                size: self.texture_size
                size_hint_x: None
            Spinner:
                # size_hint: None, None
                # size: 100, 44
                # pos_hint: {'center': (.5, .5)}
                text: 'Home'
                values: 'Home', 'Work', 'Other', 'Custom'
                on_text:
                    print("The spinner {} has text {}".format(self, self.text))

        Label:
            id: filler

        # Transport buttons
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: sidebar_row_height
            spacing: 5
            ToggleButton:
                id: btn_rec
                text: 'üî¥'
                font_name: 'seguiemj'
                # on_press: self.text = '‚¨õÔ∏è'
                on_state: 
                    self.text = '‚¨õÔ∏è' if self.state == 'down' else 'üî¥'
                    print("Start" if self.state == 'down' else "Stop", "recording") #
            Button:
                id: btn_photo
                text: 'üì∏'
                font_name: 'seguiemj'
                on_press: print("Cheeeese!")
        
        # Timer and attribution
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 20
            Label:
                text: '00:00:00'
                width: self.parent.width / 2
                height: self.texture_size[1]
                size_hint_x: None
            Label:  # Filler
            Label:
                text: 'by LeoDJ'
                size: self.texture_size
                size_hint: None, None
                # text_size: self.size
                # halign: 'right'

# Schedule frame update
# on_start: root.update_frame()